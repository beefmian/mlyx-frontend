!function(e,n){"use strict";if("function"==typeof define&&define.amd)define(["jquery"],n);else if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n(require("jquery"));else{if("undefined"==typeof jQuery)throw"LoginManager requires jQuery to be loaded first";e.LoginManager=n(jQuery)}}(this,function(e){var n={domain:"mlyx.com",origin:"https://userapi.mlyx.com",ptlogin:"http://user.mlyx.com/ptlogin"};document.domain=n.domain;var o={userInfo:null,getCookie:function(e){var n,o=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(n=document.cookie.match(o))?unescape(n[2]):null},setCookie:function(e,o,i){var i=i||30,t=new Date;t.setTime(t.getTime()+24*i*60*60*1e3),document.cookie=e+"="+escape(o)+";expires="+t.toGMTString()+";domain="+n.domain+";path=/"},delCookie:function(e){var o=new Date;o.setTime(o.getTime()-1);var i=this.getCookie(e);null!=i&&(document.cookie=e+"="+i+";expires="+o.toGMTString()+";domain="+n.domain)},getUrlParam:function(e){return decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURI(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))},login:function(i){e.ajax({url:n.origin+"/user/login/byemail",data:{email:i.username,pwd:i.password,validatecode:i.validatecode},dataType:"jsonp",jsonp:"function",success:function(n){1==n.status&&(o.userInfo=n.data,o.setCookie("USER_INFO",JSON.stringify(n.data),1)),"function"==e.type(i.success)&&i.success(n)}})},loginByQQ:function(e){return n.origin+"/user/login/go2qq?sUrl="+encodeURIComponent(e)},loginByWeixin:function(e){return n.origin+"/user/login/go2weixin?sUrl="+encodeURIComponent(e)},loginByDialog:function(){var i=e("body"),t=e("#xlogin_wrap"),a=encodeURIComponent(location.href);if(0===t.length){var s=e('<div id="xlogin_backdrop"></div>'),r=e('<iframe id="xlogin_iframe" scrolling="no" width="100%" height="100%" frameborder="0" src=""></iframe>');t=e('<div id="xlogin_wrap"></div>'),r.attr("src",n.ptlogin+"?surl="+a),s.css({position:"fixed",top:0,left:0,zIndex:99999,width:"100%",height:"100%",overflow:"hidden",backgroundColor:"#000",filter:"alpha(opacity=50)",opacity:.5}),t.css({position:"fixed",left:"50%",top:"50%",zIndex:1e5,width:"400px",height:"400px",marginLeft:"-200px",marginTop:"-200px",backgroundColor:"#fff"}),o.needCode({yes:function(){t.css({height:"430px",marginTop:"-215px"})}}),i.append(s),t.append(r),i.append(t)}else e("#xlogin_backdrop").show(),t.show()},closeDialog:function(){e("#xlogin_backdrop").hide(),e("#xlogin_wrap").hide()},logout:function(i){e.ajax({url:n.origin+"/user/login/out",dataType:"jsonp",jsonp:"function",success:function(n){1==n.status&&(o.userInfo=null,o.delCookie("USER_INFO")),"function"==e.type(i.success)&&i.success(n)}})},isLogined:function(i){e.ajax({url:n.origin+"/user/info/all",dataType:"jsonp",jsonp:"function",success:function(n){1==n.status&&(o.userInfo=n.data,o.setCookie("USER_INFO",JSON.stringify(n.data),1)),"function"==e.type(i)&&i(1==n.status)}})},getUserInfo:function(i){var t=o.getCookie("USER_INFO");t?(o.userInfo=JSON.parse(t),"function"==e.type(i)&&i(JSON.parse(t))):e.ajax({url:n.origin+"/user/info/all",dataType:"jsonp",jsonp:"function",success:function(n){1==n.status&&(o.userInfo=n.data,o.setCookie("USER_INFO",JSON.stringify(n.data),1)),"function"==e.type(i)&&i(n.data)}})},needCode:function(o){e.ajax({url:n.origin+"/user/login/needvalidatecode",dataType:"jsonp",jsonp:"function",success:function(n){1==n.status?"function"==e.type(o.yes)&&o.yes():"function"==e.type(o.no)&&o.no()}})},getCode:function(){return n.origin+"/user/validatecode/image?_="+(new Date).getTime()}};return o});